{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["/**\r\n * 该对象上有一些方法，调用这些方法可以对数据进行响应式代理\r\n */\r\nclass Observe{\r\n  constructor(data){\r\n    this.walk(data);\r\n  }\r\n  /**\r\n   * 循环该对象所有keys，对所有属性进行代理劫持\r\n   * @param {待劫持的数据对象} data \r\n   */\r\n  walk(data){\r\n    // 重新定义属性\r\n    Object.keys(data).forEach(key=> defineReactive(data,key,data[key]))\r\n  }\r\n}\r\n/**\r\n * \r\n * @param {重新定义数据的目标} target \r\n * @param {目标的key} key \r\n * @param {目标的value} value \r\n */\r\nexport function defineReactive(target,key,value){\r\n  // 使用递归，对值为对象的数据，再次进行劫持\r\n  observe(value);// 内部进行判断，如果value不是对象，则结束调用\r\n  Object.defineProperty(target,key,{\r\n    // 取值的时候\r\n    get(){\r\n      return value;\r\n    },\r\n    // 修改的时候\r\n    set(newValue){\r\n      if(newValue===value)return;\r\n      value = newValue;\r\n    }\r\n  })\r\n\r\n}\r\n/**\r\n * 劫持用户的数据，进行响应式代理\r\n * 会判断用户的数据里面是不是还是对象\r\n * 如果还是对象，则会递归调用代理\r\n * @param {用户选项data中的数据} data \r\n */\r\nexport function observe(data){\r\n  if(typeof data !== 'object'||data === null){\r\n    return;// 只对对象做劫持\r\n  }\r\n  // 如果一个对象被劫持了，那就不需要再被劫持了\r\n  // 要判断一个对象是否被劫持过了，\r\n  // 可以增添一个实例，用实例来判断是否被劫持过\r\n\r\n  return new Observe(data);\r\n}","import { observe } from \"./observe/index\";\r\n\r\n/**\r\n * 初始化用户状态 data,props,methods,watch...\r\n * @param {Vue实例对象} vm \r\n */\r\nexport function initState(vm){\r\n  const opts = vm.$options;// 获取所有的选项\r\n  // if(opts.props){\r\n  //   initProps\r\n  // }\r\n  if(opts.data){\r\n    initData(vm)\r\n  }\r\n}\r\n/**\r\n * \r\n * @param {实例} vm \r\n * @param {代理数据} target \r\n * @param {代理数据的key} key \r\n */\r\nfunction proxy(vm,target,key){\r\n  // vm.name ==> vm._data.name\r\n  Object.defineProperty(vm,key,{\r\n    get(){\r\n      return vm[target][key]\r\n    },\r\n    set(newValue){\r\n      vm[target][key] = newValue\r\n    }\r\n  })\r\n}\r\n/**\r\n * 对 options.data 数据进行响应式拦截\r\n * @param {Vue实例对象} vm \r\n */\r\nfunction initData(vm){\r\n  // 将对象上的数据重新 赋值了一份，data和源对象断开连接\r\n  let data = vm.$options.data;// 可能是函数或对象\r\n  data = typeof data === 'function'?data.call(vm):data;\r\n  // 给实例对象设置上data，可以获取到代理劫持后的数据\r\n  vm._data = data\r\n  // 对数据进行劫持 vue2采用defineProperty\r\n  observe(data);\r\n  // 将vm._data上的所有数据代理直接代理到实例对象上\r\n  for(let key in data){\r\n    proxy(vm,'_data',key)\r\n  }\r\n\r\n}","import { initState } from \"./state\";\r\n\r\n/**\r\n * 用于给Vue实例身上拓展方法\r\n * @param {Vue实例对象} Vue \r\n */\r\nexport function initMixin(Vue){\r\n  /**\r\n   * 用于初始化操作\r\n   */\r\n  Vue.prototype._init = function(options){\r\n    const vm = this;\r\n    // 将用户传入的配置数据装载到Vue实例身上，方便其他方法获取配置数据\r\n    vm.$options = options;\r\n    initState(vm);\r\n  } \r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\n\r\n\r\n/**\r\n * options:用户传入的选项 data,methods,computed,mounted....\r\n * \r\n */\r\nfunction Vue(options){\r\n  // initMixin在Vue对象上拓展的_init方法的方法\r\n  this._init(options)\r\n}\r\ninitMixin(Vue)\r\n\r\nexport default Vue;"],"names":["Observe","data","_classCallCheck","walk","_createClass","key","value","Object","keys","forEach","defineReactive","target","observe","defineProperty","get","set","newValue","_typeof","initState","vm","opts","$options","initData","proxy","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}